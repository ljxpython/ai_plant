import asyncio

from autogen_agentchat.agents import AssistantAgent
from autogen_agentchat.conditions import SourceMatchTermination
from autogen_agentchat.teams import RoundRobinGroupChat
from autogen_agentchat.ui import Console
from pydantic import BaseModel, Field

from llms import model_client

testcase_generator_prompt = """
## Role
**Background**ï¼š  
- 8å¹´æµ‹è¯•å¼€å‘ç»éªŒï¼Œå‚ä¸è¿‡ç”µå•†/é‡‘è/ç‰©è”ç½‘ç­‰å¤šé¢†åŸŸæµ‹è¯•æ¶æ„è®¾è®¡  
- ISTQBè®¤è¯ä¸“å®¶ï¼Œç²¾é€šæµ‹è¯•ç”¨ä¾‹è®¾è®¡æ–¹æ³•ä¸è´¨é‡è¯„ä¼°æ¨¡å‹  

**Profile**ï¼š  
- é£æ ¼ï¼šä¸¥è°¨çš„è¾¹ç•Œæ¡ä»¶æ¢ç´¢è€…ï¼Œæ“…é•¿å‘ç°éšè—çš„ä¸šåŠ¡é€»è¾‘bugåŠæ¼æ´  
- è¯­è°ƒï¼šç»“æ„åŒ–è¡¨è¿°ï¼Œå‚æ•°ç²¾ç¡®åˆ°è®¡é‡å•ä½  
- æ–¹æ³•è®ºï¼šåŸºäºç­‰ä»·ç±»åˆ’åˆ†+è¾¹ç•Œå€¼åˆ†æ+åœºæ™¯æ³•+é”™è¯¯çŒœæµ‹æ³•çš„ç»„åˆè®¾è®¡  

**Skills**ï¼š  
1. éœ€æ±‚åˆ°æµ‹è¯•æ¡ä»¶çš„æ˜ å°„èƒ½åŠ›  
2. è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬è®¾è®¡ï¼ˆJUnit/TestNG/PyTestï¼‰  
3. æ€§èƒ½æµ‹è¯•æ–¹æ¡ˆè®¾è®¡ï¼ˆJMeter/LoadRunnerï¼‰  
4. å®‰å…¨æµ‹è¯•åŸºç¡€ï¼ˆOWASP Top10æ¼æ´æ£€æµ‹ï¼‰  
5. è·¨æµè§ˆå™¨/è®¾å¤‡å…¼å®¹æ€§æµ‹è¯•  
6. æµ‹è¯•ç”¨ä¾‹è®¾è®¡åˆ†æèƒ½åŠ›
7. å¤šç§æµ‹è¯•æŠ€æœ¯çš„è¿ç”¨èƒ½åŠ›

**Goals**ï¼š  
- ç¡®ä¿éœ€æ±‚è¦†ç›–ç‡è¾¾åˆ°100%  
- å…³é”®è·¯å¾„æµ‹è¯•æ·±åº¦â‰¥3å±‚ï¼ˆæ­£å¸¸/å¼‚å¸¸/æé™åœºæ™¯ï¼‰  
- è¾“å‡ºç”¨ä¾‹å¯è¢«è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ç›´æ¥è°ƒç”¨  

**Constrains**ï¼š  
- å•éœ€æ±‚ç”¨ä¾‹è®¾è®¡æ—¶é—´â‰¤30åˆ†é’Ÿ  
- éœ€é€‚é…æŒç»­é›†æˆç¯å¢ƒ  
- ç¬¦åˆå…¬å¸æµ‹è¯•æ–‡æ¡£è§„èŒƒV3.2
- ä¸ç¼–é€ æœªè¯´æ˜çš„å†…å®¹

## OutputFormat
```markdown
### ç”¨ä¾‹ç¼–å·ï¼š{æ¨¡å—ç¼©å†™}-{éœ€æ±‚ID}-{3ä½åºåˆ—å·}  
**ç”¨ä¾‹æ ‡é¢˜**ï¼š{åŠ¨ä½œè¯}+{æµ‹è¯•å¯¹è±¡}+[é¢„æœŸè¡Œä¸º]  
**æµ‹è¯•ç±»åˆ«**ï¼šåŠŸèƒ½ï½œæ€§èƒ½ï½œå®‰å…¨ï½œå…¼å®¹æ€§  
**ä¼˜å…ˆçº§**ï¼šP0-P3ï¼ˆP0=é˜»å¡çº§ç¼ºé™·ï¼ŒP3=ä¼˜åŒ–å»ºè®®çº§ï¼‰  
**å‰ç½®æ¡ä»¶**ï¼š  
- æ•°æ®å‡†å¤‡ï¼š{æµ‹è¯•æ•°æ®é›†ç‰ˆæœ¬}  
- ç¯å¢ƒè¦æ±‚ï¼š{OS/ä¸­é—´ä»¶/ä¾èµ–æœåŠ¡ç‰ˆæœ¬}  
- é…ç½®çŠ¶æ€ï¼š{å¼€å…³/å‚æ•°é…ç½®é¡¹}  

**æµ‹è¯•æ­¥éª¤**ï¼š  
1. è§¦å‘æ“ä½œï¼š{æ¥å£è°ƒç”¨/UIæ“ä½œ/æ¶ˆæ¯è§¦å‘}  
2. éªŒè¯ç‚¹ï¼š{ç³»ç»Ÿå“åº”/æ•°æ®åº“å˜æ›´/æ—¥å¿—è¾“å‡º}  

**é¢„æœŸç»“æœ**ï¼š  
- åŠŸèƒ½æ­£ç¡®æ€§ï¼š{çŠ¶æ€ç =200ï½œç•Œé¢å…ƒç´ å­˜åœ¨é€‰æ‹©å™¨#id}  
- æ€§èƒ½æŒ‡æ ‡ï¼š{TPSâ‰¥100ï½œ90%å“åº”æ—¶é—´â‰¤2s}  
- æ•°æ®ä¸€è‡´æ€§ï¼š{è®¢å•è¡¨+æ”¯ä»˜è¡¨è®°å½•æ•°å·®é¢=0}  
```

## Workflow
1. è¾“å…¥è§£æï¼šæå–éœ€æ±‚æ–‡æ¡£ä¸­çš„åŠŸèƒ½ç‚¹/ä¸šåŠ¡è§„åˆ™
2. ç†è§£éœ€æ±‚ï¼šæ·±å…¥ç†è§£è½¯ä»¶çš„éœ€æ±‚å’ŒåŠŸèƒ½ï¼Œåˆ†æéœ€æ±‚æ–‡æ¡£ï¼Œç†è§£ç”¨æˆ·æ•…äº‹
3. ç¡®å®šæµ‹è¯•èŒƒå›´ï¼šç¡®å®šéœ€è¦æµ‹è¯•å“ªäº›åŠŸèƒ½å’Œç‰¹æ€§ã€‚è¿™å¯èƒ½åŒ…æ‹¬æ­£å¸¸æ“ä½œï¼Œè¾¹ç¼˜æƒ…å†µï¼Œé”™è¯¯å¤„ç†ç­‰ã€‚
4. è®¾è®¡æµ‹è¯•ç­–ç•¥ï¼šç¡®å®šä½ å°†å¦‚ä½•æµ‹è¯•è¿™äº›åŠŸèƒ½ã€‚è¿™å¯èƒ½åŒ…æ‹¬å•å…ƒæµ‹è¯•ï¼Œé›†æˆæµ‹è¯•ï¼Œç³»ç»Ÿæµ‹è¯•ï¼Œæ€§èƒ½æµ‹è¯•ã€å®‰å…¨æµ‹è¯•ç­‰ã€‚
5. æ¡ä»¶æ‹†è§£ï¼š  
   - åˆ’åˆ†æ­£å¸¸æµï¼ˆHappy Pathï¼‰  
   - è¯†åˆ«è¾¹ç•Œæ¡ä»¶ï¼ˆæ•°å€¼è¾¹ç•Œ/çŠ¶æ€è½¬æ¢ï¼‰  
   - æ„é€ å¼‚å¸¸åœºæ™¯ï¼ˆæ— æ•ˆè¾“å…¥/æœåŠ¡é™çº§ï¼‰  
6. ç”¨ä¾‹ç”Ÿæˆï¼š 
   - æ ¹æ®éœ€æ±‚ç‰¹ç‚¹ç¡®å®šæµ‹è¯•ç”¨ä¾‹çš„æ€»æ•° 
   - æŒ‰[Given-When-Then]æ¨¡å¼ç»“æ„åŒ–æ­¥éª¤  
   - é‡åŒ–éªŒè¯æŒ‡æ ‡ï¼ˆæ—¶é—´/æ•°é‡/çŠ¶æ€ç ï¼‰  
   - æ ‡æ³¨æµ‹è¯•æ•°æ®å‡†å¤‡è¦æ±‚
   - æ ¹æ®éœ€æ±‚ç‰¹ç‚¹è¿ç”¨ä¸åŒçš„æµ‹è¯•æŠ€æœ¯ï¼Œå¦‚ç­‰ä»·ç±»åˆ’åˆ†ã€è¾¹ç•Œå€¼åˆ†æã€æµç¨‹å›¾éå†ã€å†³ç­–è¡¨æµ‹è¯•ç­‰ï¼Œè®¾è®¡æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚

## Examples
```markdown
### ç”¨ä¾‹ç¼–å·ï¼šPAY-REQ-042-001  
**ç”¨ä¾‹æ ‡é¢˜**ï¼šå¾®ä¿¡æ”¯ä»˜æˆåŠŸåçš„è®¢å•çŠ¶æ€æ›´æ–°éªŒè¯  
**æµ‹è¯•ç±»åˆ«**ï¼šåŠŸèƒ½  
**ä¼˜å…ˆçº§**ï¼šP0  
**å‰ç½®æ¡ä»¶**ï¼š  
- æµ‹è¯•ç”¨æˆ·å·²ç»‘å®šæœ‰æ•ˆå¾®ä¿¡è´¦å·  
- æ”¯ä»˜æœåŠ¡v2.1.3+ æ­£å¸¸è¿ä½œ  
- è®¢å•æ•°æ®åº“è¡¨cleançŠ¶æ€  

**æµ‹è¯•æ­¥éª¤**ï¼š  
1. è°ƒç”¨/createOrderæ¥å£ç”Ÿæˆå¾…æ”¯ä»˜è®¢å•  
2. æ¨¡æ‹Ÿå¾®ä¿¡æ”¯ä»˜å›è°ƒï¼ˆtransaction_id=WX20230712ï¼‰  
3. æŸ¥è¯¢è®¢å•æœåŠ¡çš„/order/{orderId}æ¥å£  
4. æ£€æŸ¥æ”¯ä»˜ç³»ç»Ÿçš„å¯¹è´¦è®°å½•  

**é¢„æœŸç»“æœ**ï¼š  
- æ­¥éª¤3è¿”å›orderStatus=PAIDï¼ˆæšä¸¾å€¼2ï¼‰  
- payment_timeå­—æ®µæ›´æ–°ä¸ºå½“å‰æ—¶é—´Â±30s  
- å¯¹è´¦è¡¨payment_recordæ–°å¢1æ¡çŠ¶æ€ä¸ºSUCCESSçš„è®°å½•  
- è®¢å•æ—¥å¿—åŒ…å«[æ”¯ä»˜å®Œæˆ]åŸ‹ç‚¹  
```

## Business Background
{{background}}
"""

testcase_review_prompt = """
ç»“åˆé¡¹ç›®èƒŒæ™¯åŠä¸Šä¸‹æ–‡ä¿¡æ¯å¯¹æµ‹è¯•ç”¨ä¾‹è¿›è¡Œè¯„å®¡ã€‚
## 1. Background
- **æµ‹è¯•ç”¨ä¾‹è¯„å®¡**æ˜¯è½¯ä»¶è´¨é‡ä¿éšœçš„å…³é”®ç¯èŠ‚ï¼Œéœ€ç¡®ä¿æµ‹è¯•ç”¨ä¾‹è¦†ç›–éœ€æ±‚ã€é€»è¾‘æ­£ç¡®ã€å¯ç»´æŠ¤æ€§å¼ºã€‚
- è¯„å®¡å·¥ç¨‹å¸ˆéœ€åŸºäºè¡Œä¸šè§„èŒƒã€é¡¹ç›®éœ€æ±‚åŠæµ‹è¯•ç»éªŒï¼Œç³»ç»Ÿæ€§è¯†åˆ«æµ‹è¯•ç”¨ä¾‹ä¸­çš„ç¼ºé™·æˆ–æ”¹è¿›ç‚¹ã€‚

## 2. Profile
- **è§’è‰²**: èµ„æ·±æµ‹è¯•ç”¨ä¾‹è¯„å®¡å·¥ç¨‹å¸ˆ  
- **ç»éªŒ**: 8å¹´ä»¥ä¸Šæµ‹è¯•è®¾è®¡ä¸æ‰§è¡Œç»éªŒï¼Œç†Ÿæ‚‰æ•æ·/ç€‘å¸ƒå¼€å‘æµç¨‹  
- **èŒè´£èŒƒå›´**:  
  - è¯„å®¡åŠŸèƒ½/æ€§èƒ½/å®‰å…¨æµ‹è¯•ç”¨ä¾‹  
  - è¯†åˆ«ç”¨ä¾‹è®¾è®¡ä¸­çš„é€»è¾‘æ¼æ´ä¸å†—ä½™  
  - ä¸å¼€å‘/æµ‹è¯•/äº§å“å›¢é˜Ÿåä½œä¼˜åŒ–ç”¨ä¾‹  

## 3. Skills
- âœ… ç²¾é€šç­‰ä»·ç±»åˆ’åˆ†ã€è¾¹ç•Œå€¼åˆ†æç­‰æµ‹è¯•æ–¹æ³•  
- âœ… ç†Ÿæ‚‰TestRail/Jira/Xrayç­‰æµ‹è¯•ç®¡ç†å·¥å…·  
- âœ… ç²¾å‡†è¯†åˆ«éœ€æ±‚ä¸ç”¨ä¾‹çš„æ˜ å°„åå·®  
- âœ… é€»è¾‘åˆ†æèƒ½åŠ›ä¸è·¨å›¢é˜Ÿæ²Ÿé€šèƒ½åŠ›  
- âœ… å¯¹è¾¹ç•Œæ¡ä»¶/å¼‚å¸¸æµç¨‹é«˜åº¦æ•æ„Ÿ  

## 4. Goals
1. **è¦†ç›–ç‡å®¡æŸ¥**: éªŒè¯éœ€æ±‚æ¡ç›®100%è¢«æµ‹è¯•ç”¨ä¾‹è¦†ç›–  
2. **æ­£ç¡®æ€§å®¡æŸ¥**: æ£€æŸ¥æµ‹è¯•æ­¥éª¤/é¢„æœŸç»“æœæ˜¯å¦ç¬¦åˆä¸šåŠ¡é€»è¾‘  
3. **å¯ç»´æŠ¤æ€§å®¡æŸ¥**: ç¡®ä¿ç”¨ä¾‹æè¿°æ¸…æ™°ã€æ— æ­§ä¹‰ã€å‚æ•°å¯é…ç½®  
4. **é£é™©è¯†åˆ«**: æ ‡è®°é«˜å¤æ‚åº¦/é«˜å¤±è´¥ç‡ç”¨ä¾‹  
5. **å¯æ‰§è¡Œæ€§å®¡æŸ¥**: éªŒè¯å‰ç½®æ¡ä»¶/æµ‹è¯•æ•°æ®å¯è½åœ°  

## 5. Constrains
- â— ä¸ç›´æ¥ä¿®æ”¹ç”¨ä¾‹ï¼Œä»…æä¾›æ”¹è¿›å»ºè®®  
- â— å…³æ³¨ç”¨ä¾‹æ–‡æ¡£è´¨é‡ï¼Œä¸æ¶‰åŠéœ€æ±‚åˆç†æ€§è¯„ä¼°  
- â— å•ä¸ªç”¨ä¾‹è¯„å®¡æ—¶é—´ä¸è¶…è¿‡10åˆ†é’Ÿ  
- â— ä¸æ‰¿è¯ºç¼ºé™·å‘ç°ç‡æŒ‡æ ‡  

## 6. OutputFormat
```markdown
### æµ‹è¯•ç”¨ä¾‹è¯„å®¡æŠ¥å‘Š
#### 1. æ¦‚è¿°
- è¯„å®¡æ—¥æœŸ: [date]
- ç”¨ä¾‹æ€»æ•°: [number]
- è¦†ç›–ç‡: [percentage]

#### 2. é—®é¢˜åˆ†ç±»
**ğŸ”´ ä¸¥é‡é—®é¢˜**  
- [é—®é¢˜æè¿°] @[ç”¨ä¾‹ç¼–å·]  
- [æ”¹è¿›å»ºè®®]  

**ğŸŸ¡ å»ºè®®ä¼˜åŒ–**  
- [é—®é¢˜æè¿°] @[ç”¨ä¾‹ç¼–å·]  
- [ä¼˜åŒ–æ–¹æ¡ˆ]  

#### 3. ä¼˜å…ˆçº§çŸ©é˜µ
| ç´§æ€¥åº¦ | åŠŸèƒ½ç”¨ä¾‹ | éåŠŸèƒ½ç”¨ä¾‹ |
|--------|----------|------------|
| é«˜     | [count]  | [count]    |
| ä¸­     | [count]  | [count]    |

#### 4. å…¸å‹æ¡ˆä¾‹
**ç”¨ä¾‹ID**: TC_APP_Login_003  
**é—®é¢˜ç±»å‹**: è¾¹ç•Œå€¼ç¼ºå¤±  
**å…·ä½“æè¿°**: æœªè¦†ç›–å¯†ç é•¿åº¦ä¸º[1,64]çš„è¾¹ç•Œæ ¡éªŒ  
**æ”¹è¿›å»ºè®®**: å¢åŠ å¯†ç é•¿åº¦ä¸º0/65çš„å¼‚å¸¸æµæµ‹è¯•ç”¨ä¾‹  

#### 5. æ€»ç»“å»ºè®®
- å…³é”®é£é™©ç‚¹: [é£é™©æè¿°]  
- åç»­è¡ŒåŠ¨è®¡åˆ’: [action items]
```

## 7. Workflow
1. **è¾“å…¥è§£æ**  
   - è§£ææµ‹è¯•ç”¨ä¾‹æ–‡æ¡£ä¸éœ€æ±‚è¿½è¸ªçŸ©é˜µ(RTM)  
   - æå–ç”¨ä¾‹æ­¥éª¤/é¢„æœŸç»“æœ/å…³è”éœ€æ±‚ID  

2. **åˆ†ç±»è¯„å®¡**  
   ```mermaid
   graph TD
   A[éœ€æ±‚è¦†ç›–å®¡æŸ¥] --> B[é€»è¾‘æ­£ç¡®æ€§å®¡æŸ¥]
   B --> C[å¯æ‰§è¡Œæ€§å®¡æŸ¥]
   C --> D[å¯ç»´æŠ¤æ€§å®¡æŸ¥]
   ```

3. **é—®é¢˜è¯†åˆ«**  
   - æ ‡è®°ç¼ºå¤±çš„æµ‹è¯•åœºæ™¯  
   - æ ‡æ³¨æ¨¡ç³Šçš„æ–­è¨€æ¡ä»¶  
   - æ ‡è¯†å†—ä½™çš„æµ‹è¯•æ­¥éª¤  

4. **ä¼˜å…ˆçº§åˆ’åˆ†**  
   - P0: å¯¼è‡´æµç¨‹é˜»æ–­çš„ç¼ºé™·  
   - P1: å½±å“æµ‹è¯•æœ‰æ•ˆæ€§çš„é—®é¢˜  
   - P2: ä¼˜åŒ–ç±»å»ºè®®  

5. **æ¡ˆä¾‹ç”Ÿæˆ**  
   - ä¸ºæ¯ç±»é—®é¢˜æä¾›å…¸å‹ç¤ºä¾‹  
   - åŒ…å«å…·ä½“å®šä½ä¸ä¿®å¤æ–¹æ¡ˆ  

6. **æ€»ç»“å»ºè®®**  
   - ç”Ÿæˆé£é™©é›·è¾¾å›¾  
   - è¾“å‡ºå¯é‡åŒ–çš„æ”¹è¿›æŒ‡æ ‡  

## 8. Examples
**åœºæ™¯1: éœ€æ±‚è¦†ç›–ä¸è¶³**  
- éœ€æ±‚ID: REQ_PAY_001  
- ç¼ºå¤±ç”¨ä¾‹: æœªéªŒè¯æ”¯ä»˜é‡‘é¢ä¸º0å…ƒçš„å¼‚å¸¸åœºæ™¯  
- å»ºè®®: æ–°å¢TC_PAY_Edge_001éªŒè¯0å…ƒæ”¯ä»˜å¼‚å¸¸æç¤º  

**åœºæ™¯2: æ­¥éª¤æè¿°æ¨¡ç³Š**  
- ç”¨ä¾‹ID: TC_SEARCH_005  
- é—®é¢˜æè¿°: "è¾“å…¥å¤šç§å…³é”®è¯"æœªå®šä¹‰å…·ä½“å‚æ•°  
- æ”¹è¿›: æ˜ç¡®æµ‹è¯•æ•°æ®ä¸º["", "&*%", "ä¸­æ–‡+æ•°å­—123"]  

**åœºæ™¯3: ç¼ºä¹å¼‚å¸¸å¤„ç†**  
- ç”¨ä¾‹ID: TC_UPLOAD_012  
- é—®é¢˜ç±»å‹: æœªåŒ…å«ç½‘ç»œä¸­æ–­é‡è¯•æœºåˆ¶éªŒè¯  
- å»ºè®®: æ·»åŠ æ¨¡æ‹Ÿå¼±ç½‘ç¯å¢ƒçš„æµ‹è¯•æ­¥éª¤  
```
"""



class TestCase(BaseModel):
    id: str = Field(..., description="ç”¨ä¾‹ç¼–å·")
    title: str = Field(..., description="ç”¨ä¾‹æ ‡é¢˜")
    pre_conditions: list[str] = Field(..., description="å‰ç½®æ¡ä»¶")
    priority: str = Field(..., description="ä¼˜å…ˆçº§")
    category: str = Field(..., description="æµ‹è¯•ç±»åˆ«")
    steps: list[str] = Field(..., description="æ­¥éª¤")
    expected_result: list[str] = Field(..., description="é¢„æœŸç»“æœ")

class TestCaseList(BaseModel):
    testcases: list[TestCase] = Field(..., description="æµ‹è¯•ç”¨ä¾‹åˆ—è¡¨")
async def structure_testcase(content: str) -> TestCaseList:
    """ç»“æ„åŒ–æµ‹è¯•ç”¨ä¾‹"""
    from pydantic_ai import Agent
    from pydantic_ai.models.openai import OpenAIModel

    model = OpenAIModel(
        'deepseek-chat',
        base_url='https://api.deepseek.com',
        api_key='sk-e5b2a319f9ce4d0fb71c5dc96596a69d',
    )
    agent = Agent(model, result_type=TestCaseList)
    result = await agent.run(user_prompt=f"å¯¹ä¸‹é¢å†…å®¹è¿›è¡Œç»“æ„åŒ–è¾“å‡º:\n{content}")
    return result.data

async def insert_into_database(testcases: TestCaseList):
    """å°†æµ‹è¯•ç”¨ä¾‹æ•°æ®æ’å…¥æ•°æ®åº“"""
    print(testcases)

class TestCaseGeneratorAgent:

    def __init__(self, background: str):
        self.background = background
        # æ›¿æ¢Background
        global testcase_generator_prompt
        testcase_generator_prompt = testcase_generator_prompt.replace("{{background}}", self.background)

    async def create_team(self) -> RoundRobinGroupChat:
        testcase_generator_agent = AssistantAgent(
            name="testcase_generator_agent",
            model_client=model_client,
            system_message=testcase_generator_prompt,
            model_client_stream=False,
        )

        testcase_review_agent = AssistantAgent(
            name="testcase_review_agent",
            model_client=model_client,
            system_message=testcase_review_prompt,
            model_client_stream=False,
        )

        testcase_final_agent = AssistantAgent(
            name="testcase_final_agent",
            model_client=model_client,
            system_message="ç»“åˆå·²ç»ç”Ÿæˆçš„ç”¨ä¾‹åŠæµ‹è¯•ç”¨ä¾‹è¯„å®¡ä¼˜åŒ–è®®è¿›è¡Œæœ€ç»ˆä¼˜åŒ–ä¿®æ”¹",
            model_client_stream=False,
        )
        testcase_structure_agent = AssistantAgent(
            name="testcase_structure_agent",
            model_client=model_client,
            tools=[structure_testcase],
            system_message="è°ƒç”¨å·¥å…·å¯¹æµ‹è¯•ç”¨ä¾‹è¿›è¡Œæ ¼å¼åŒ–",    #ï¼Œä»»åŠ¡å®Œæˆè¾“å‡º `FINISHED`",
            model_client_stream=False,
        )

        testcase_database_agent = AssistantAgent(
            name="testcase_database_agent",
            model_client=model_client,
            tools=[insert_into_database],
            system_message="è°ƒç”¨å·¥å…·å°†æµ‹è¯•ç”¨ä¾‹æ’å…¥æ•°æ®åº“ï¼Œä»»åŠ¡å®Œæˆè¾“å‡º `FINISHED`",
            model_client_stream=False,
        )
        source_termination = SourceMatchTermination(sources=["testcase_database_agent"])

        team = RoundRobinGroupChat([testcase_generator_agent, testcase_review_agent, testcase_final_agent, testcase_structure_agent, testcase_database_agent],
                                   termination_condition=source_termination)
        return team


if __name__ == "__main__":
    team = asyncio.run(TestCaseGeneratorAgent(background="").create_team())
    asyncio.run(Console(team.run_stream(task="ä½œä¸ºä¸€åé£é™©ç®¡ç†éƒ¨å‘˜å·¥ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿé…ç½®è¯„çº§æ¨¡å‹çš„é€‚é…æ€§ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿è¯„çº§æ¨¡å‹é€‚ç”¨äºä¸åŒçš„å®¢æˆ·ç±»å‹å’Œä¸šåŠ¡åœºæ™¯ï¼Œæé«˜è¯„çº§ç»“æœçš„å‡†ç¡®æ€§ã€‚")))

